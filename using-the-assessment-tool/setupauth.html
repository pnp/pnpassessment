<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Configure authentication | Microsoft 365 Assessment Tool </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Configure authentication | Microsoft 365 Assessment Tool ">
    <meta name="generator" content="docfx 2.56.5.0">
    <meta name="description" content="The Microsoft 365 SharePoint Assessment tool is enabling various deprecation and adoption scenarios by enabling you to assess your tenant.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <!--
        <a class="navbar-brand" href="../index.html">
          <img id="logo" class="svg" src="../logo.svg" alt="" >
        </a>
        -->
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/pnpassessment/blob/main/docs/using-the-assessment-tool/setupauth.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="configure-authentication">Configure authentication</h1>

<p>The Microsoft 365 Assessment tool uses Entra (Azure AD) based authentication and requires a configured Entra application to run. The Microsoft 365 Assessment tool supports both application permissions (app-only) and delegated (user) permissions and various ways to authenticate.</p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>If you want the assessment tool to read all sites in your tenant then using application permissions is strongly recommended as that's the only way to guarantee that the Microsoft 365 Assessment tool can read all the sites. When you want to only assess a couple of sites and your account has permissions to these sites then using delegated permissions is an option.</p>
</div>
<h2 id="setting-up-the-entra-application">Setting up the Entra application</h2>
<p>A <a href="https://entra.microsoft.com/#view/Microsoft_AAD_RegisteredApps/ApplicationsListBlade/quickStartType%7E/null/sourceType/Microsoft_AAD_IAM">configured Entra application</a> is a pre-requisite for using the Microsoft 365 Assessment tool. When you <a href="assess-start.html">start an assessment</a> you'll have to specify the Entra application to use and how you want to authenticate. It's strongly recommended to create a dedicated Entra application over re-using an existing one so you can limit the needed permissions to what's needed by the module you're using in the Microsoft 365 Assessment tool. Also as throttling rules are bound to applications there's less throttling impact if you use a dedicated Entra application for the assessments.</p>
<h3 id="permissions-required">Permissions required</h3>
<p>The Microsoft 365 Assessment tool aims to be able to perform the assessment task at hand using minimal read permissions, but for certain assessments not all features work when using minimal permissions. To understand which Microsoft Graph and SharePoint permissions are required please checkout the permission requirements of the respective modules.</p>
<ul>
<li><a href="../workflow/requirements.html">Workflow 2013 deprecation</a></li>
<li><a href="../infopath/requirements.html">InfoPath 2013 deprecation</a></li>
<li><a href="../addinsacs/requirements.html">SharePoint Add-Ins and Azure ACS deprecation</a></li>
<li><a href="../alerts/requirements.html">SharePoint Alerts deprecation</a></li>
</ul>
<div class="IMPORTANT">
<h5>Important</h5>
<p>Cross check the minimally required permissions are granted, if not the scan might fail or might return inaccurate results.</p>
</div>
<h3 id="creating-an-entra-application-using-pnp-powershell">Creating an Entra application using PnP PowerShell</h3>
<p>Using <a href="https://pnp.github.io/powershell/">PnP PowerShell</a> creating an Entra application becomes really simple. The <a href="https://pnp.github.io/powershell/cmdlets/Register-PnPAzureADApp.html">Register-PnPAzureADApp</a> cmdlet will create a new Entra application, will create a new self-signed certificate inside the <strong>Personal</strong> node (= <strong>My</strong>) of the <strong>CurrentUser</strong> certificate store, and will hookup that cert with the created Entra application. Finally the right permissions are configured and you're prompted to consent these permissions.</p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>If you encounter errors during below steps it's likely that you do not have the needed permissions. Please contact your tenant / Entra admins for help.</p>
</div>
<pre><code class="lang-PowerShell"># Sample for the Microsoft Syntex adoption module. 
# Remove/update the application/delegated permissions depending on your needs
# as each assessment module requires slightly different permissions.
#
# Also update the Tenant and Username properties to match your environment.
#
# If you prefer to have a password set to secure the created PFX file then add below parameter
# -CertificatePassword (ConvertTo-SecureString -String &quot;password&quot; -AsPlainText -Force)
#
# See https://pnp.github.io/powershell/cmdlets/Register-PnPAzureADApp.html for more options
#
Register-PnPAzureADApp -ApplicationName Microsoft365AssessmentToolForSyntex `
                       -Tenant contoso.onmicrosoft.com `
                       -Store CurrentUser `
                       -GraphApplicationPermissions &quot;Sites.Read.All&quot; `
                       -SharePointApplicationPermissions &quot;Sites.FullControl.All&quot; `
                       -GraphDelegatePermissions &quot;Sites.Read.All&quot;, &quot;User.Read&quot; `
                       -SharePointDelegatePermissions &quot;AllSites.Manage&quot; `
                       -Username &quot;joe@contoso.onmicrosoft.com&quot; `
                       -Interactive
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>Replace <code>contoso.onmicrosoft.com</code> with your Entra tenant name and ensure you replace <code>joe@contoso.onmicrosoft.com</code> with the user id that's an Entra admin (or global admin). If you're unsure what your Entra tenant name is then go to <a href="https://entra.microsoft.com/#view/Microsoft_AAD_IAM/TenantOverview.ReactView">https://entra.microsoft.com/#view/Microsoft_AAD_IAM/TenantOverview.ReactView</a> and check for the value of <strong>Primary domain</strong>.</p>
</div>
<p>Once you've pressed enter on above command, you'll be prompted to sign-in and you should sign-in using the user you've specified for the <code>Username</code> parameter. After that's done the Entra application will be created and configured, followed by a wait of 60 seconds to ensure the creation has been propagated across all systems. The final step is the admin consent flow: you'll again be prompted to sign-in with the specified admin user, followed by a consent dialog showing the permissions that are being granted to the application. Press <strong>Accept</strong> to finalize the consent flow. In the resulting output you'll get some key information:</p>
<pre><code class="lang-text">Pfx file               : D:\assessment\Microsoft365AssessmentTool.pfx
Cer file               : D:\assessment\Microsoft365AssessmentTool.cer
AzureAppId/ClientId    : 95610f5d-729a-4cd1-9ad7-1fa9052e50dd
Certificate Thumbprint : 165CCE93E08FD3CD85B7B25D5E91C05B1D1E49FE
</code></pre>
<p>Running the <code>Register-PnPAzureADApp</code> did not only create and configure the Entra application, it also did create a certificate for the application permission flow. This certificate has been added to the current user's certificate store, under the personal node. You can use <code>certmgr</code> on the command line to open up the local user's certificate store.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The certificate is also exported as PFX file and cer file on the file system, feel free to delete these exported files as it's easier to use the certificate from the certificate store.</p>
</div>
<p>When you now want to use the certificate for starting an assessment, you need to set <code>--authmode</code> to <code>application</code> and tell the Microsoft 365 Assessment tool which certificate to use via the certificate path parameter: <code>--certpath &quot;My|CurrentUser|165CCE93E08FD3CD85B7B25D5E91C05B1D1E49FE&quot;</code>. Next to that you also need to specify the Entra application to use via the <code>--applicationid</code> parameter. More details on how to configure authentication when starting an assessment can be found <a href="assess-start.html#authentication-configuration">here</a>.</p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>Notice that the last part in the <code>--certpath</code> string is the certificate thumbprint to use. If you've not captured that thumbprint earlier on you can get it by looking up your certificate via <code>certmgr</code>, opening it to the <strong>Details</strong> tab and scrolling down to the <strong>Thumbprint</strong> field. Select the shown value and press <code>CTRL-C</code> to copy it.</p>
</div>
<h3 id="creating-an-entra-application-using-the-entra-portal">Creating an Entra application using the Entra Portal</h3>
<p>Previous chapter described approach that creates and configures an Entra application by using <a href="https://pnp.github.io/powershell/">PnP PowerShell</a>. If you want to manually create the Entra application that's an option as well. Follow below steps to create and configure your Entra application:</p>
<ol>
<li>Navigate to <a href="https://entra.microsoft.com">Entra Portal</a> and click on <strong>Applications</strong>, followed by <strong>App registrations</strong> from the left navigation</li>
<li>Click on <strong>New registration</strong> page</li>
<li>Provide a <strong>Name</strong> for your Entra application (e.g. Microsoft365AssessmentToolForWorkflow)</li>
<li>Select <strong>Public client/native (mobile &amp; desktop)</strong> and enter <strong>http://localhost</strong> as redirect URI</li>
<li>Click on <strong>Register</strong> and the Entra application gets created and opened</li>
<li>Choose <strong>API permissions</strong> from the left navigation and add the needed delegated and/or application permissions. See the requirements page of the module you want to use for the exact permissions</li>
<li>Click on <strong>Grant admin consent for...</strong> to consent the added permissions</li>
</ol>
<p>When you want to use the <strong>Device</strong> authentication then also:</p>
<ol>
<li>Under <strong>Authentication</strong> set <strong>Allow public client flows</strong> to <strong>Yes</strong></li>
</ol>
<p>When you want to use <strong>Application</strong> authentication then also:</p>
<ol>
<li>Ensure you've defined the needed application permissions via the <strong>API permissions</strong> link the left navigation. See the requirements page of the module you want to use for the exact permissions and don't forget to click on <strong>Grant admin consent for...</strong> to consent the added permissions</li>
<li>Go to <strong>Certificates &amp; secrets</strong>, click on <strong>Certificates</strong> and <strong>Upload certificate</strong>, pick the .cer file of your certificate and add it.</li>
</ol>
<div class="NOTE">
<h5>Note</h5>
<p>If you don't have a certificate available then you can use Windows PowerShell to create one: <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-self-signed-certificate">https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-self-signed-certificate</a>.</p>
</div>
</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Microsoft 365 Assessment Tool<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>  </body>
</html>